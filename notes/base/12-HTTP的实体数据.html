<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>数据类型与编码 | HTTP协议</title>
    <meta name="description" content="HTTP协议笔记">
    <link rel="icon" href="/http-protocol/logo.png">
  <link rel="manifest" href="/http-protocol/manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="/http-protocol/icons/apple-touch-icon-152x152.png">
  <link rel="mask-icon" href="/http-protocol/icons/safari-pinned-tab.svg" color="#3eaf7c">
  <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#000000">
  <meta name="apple-mobile-web-app-status-bar-style">
    
    <link rel="preload" href="/http-protocol/assets/css/0.styles.b675c6e7.css" as="style"><link rel="preload" href="/http-protocol/assets/js/app.0cce05a9.js" as="script"><link rel="preload" href="/http-protocol/assets/js/4.7a93d0ed.js" as="script"><link rel="preload" href="/http-protocol/assets/js/35.220afe2a.js" as="script"><link rel="preload" href="/http-protocol/assets/js/7.1fd81328.js" as="script"><link rel="prefetch" href="/http-protocol/assets/js/10.1a4fd81e.js"><link rel="prefetch" href="/http-protocol/assets/js/11.9df38c1d.js"><link rel="prefetch" href="/http-protocol/assets/js/12.8c02302e.js"><link rel="prefetch" href="/http-protocol/assets/js/13.1b41a4b4.js"><link rel="prefetch" href="/http-protocol/assets/js/14.90547274.js"><link rel="prefetch" href="/http-protocol/assets/js/15.8962bc20.js"><link rel="prefetch" href="/http-protocol/assets/js/16.2722bc6a.js"><link rel="prefetch" href="/http-protocol/assets/js/17.df8a2743.js"><link rel="prefetch" href="/http-protocol/assets/js/18.bde6d342.js"><link rel="prefetch" href="/http-protocol/assets/js/19.4d443996.js"><link rel="prefetch" href="/http-protocol/assets/js/20.935291d4.js"><link rel="prefetch" href="/http-protocol/assets/js/21.2c7d5f12.js"><link rel="prefetch" href="/http-protocol/assets/js/22.02fbf24a.js"><link rel="prefetch" href="/http-protocol/assets/js/23.a3870d7c.js"><link rel="prefetch" href="/http-protocol/assets/js/24.8ff6bc93.js"><link rel="prefetch" href="/http-protocol/assets/js/25.440c53f4.js"><link rel="prefetch" href="/http-protocol/assets/js/26.a7d1f2b8.js"><link rel="prefetch" href="/http-protocol/assets/js/27.ed248eac.js"><link rel="prefetch" href="/http-protocol/assets/js/28.2dd02504.js"><link rel="prefetch" href="/http-protocol/assets/js/29.c8cdac1f.js"><link rel="prefetch" href="/http-protocol/assets/js/30.19b569b8.js"><link rel="prefetch" href="/http-protocol/assets/js/31.876b77c3.js"><link rel="prefetch" href="/http-protocol/assets/js/32.f3ac294b.js"><link rel="prefetch" href="/http-protocol/assets/js/33.fcd0c437.js"><link rel="prefetch" href="/http-protocol/assets/js/34.ca083c31.js"><link rel="prefetch" href="/http-protocol/assets/js/36.68b3b6f6.js"><link rel="prefetch" href="/http-protocol/assets/js/37.895746b0.js"><link rel="prefetch" href="/http-protocol/assets/js/38.10c1637e.js"><link rel="prefetch" href="/http-protocol/assets/js/39.e77be0dc.js"><link rel="prefetch" href="/http-protocol/assets/js/40.6c45c829.js"><link rel="prefetch" href="/http-protocol/assets/js/41.72424b73.js"><link rel="prefetch" href="/http-protocol/assets/js/42.d74f90e5.js"><link rel="prefetch" href="/http-protocol/assets/js/43.63b1c5c9.js"><link rel="prefetch" href="/http-protocol/assets/js/44.93aae44c.js"><link rel="prefetch" href="/http-protocol/assets/js/45.a17215c3.js"><link rel="prefetch" href="/http-protocol/assets/js/46.78be481c.js"><link rel="prefetch" href="/http-protocol/assets/js/47.6a48ce04.js"><link rel="prefetch" href="/http-protocol/assets/js/5.811674b8.js"><link rel="prefetch" href="/http-protocol/assets/js/6.ebecd21b.js"><link rel="prefetch" href="/http-protocol/assets/js/8.225ea378.js"><link rel="prefetch" href="/http-protocol/assets/js/9.960c6d15.js"><link rel="prefetch" href="/http-protocol/assets/js/vendors~docsearch.15b7b07c.js"><link rel="prefetch" href="/http-protocol/assets/js/vendors~notification.521adeb0.js">
    <link rel="stylesheet" href="/http-protocol/assets/css/0.styles.b675c6e7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/http-protocol/" class="home-link router-link-active"><!----> <span class="site-name">HTTP协议</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/poetries/http-protocol" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/poetries/http-protocol" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>基础篇</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/http-protocol/notes/base/01-HTTP的前世今生.html" class="sidebar-link">HTTP的前世今生</a></li><li><a href="/http-protocol/notes/base/02-HTTP是什么.html" class="sidebar-link">HTTP是什么</a></li><li><a href="/http-protocol/notes/base/03-HTTP世界全览.html" class="sidebar-link">HTTP世界全览</a></li><li><a href="/http-protocol/notes/base/04-HTTP分层.html" class="sidebar-link">HTTP分层</a></li><li><a href="/http-protocol/notes/base/05-键入网址到回车发生什么.html" class="sidebar-link">键入网址到回车发生什么</a></li><li><a href="/http-protocol/notes/base/06-HTTP报文是什么样子的.html" class="sidebar-link">HTTP报文是什么样子的</a></li><li><a href="/http-protocol/notes/base/07-理解请求方法.html" class="sidebar-link">理解请求方法</a></li><li><a href="/http-protocol/notes/base/08-URI.html" class="sidebar-link">URI</a></li><li><a href="/http-protocol/notes/base/09-响应状态码.html" class="sidebar-link">响应状态码</a></li><li><a href="/http-protocol/notes/base/10-HTTP有哪些特点.html" class="sidebar-link">HTTP有哪些特点</a></li><li><a href="/http-protocol/notes/base/11-HTTP优缺点.html" class="sidebar-link">HTTP优缺点</a></li><li><a href="/http-protocol/notes/base/12-HTTP的实体数据.html" class="active sidebar-link">HTTP的实体数据</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/http-protocol/notes/base/12-HTTP的实体数据.html#数据类型与编码" class="sidebar-link">数据类型与编码</a></li><li class="sidebar-sub-header"><a href="/http-protocol/notes/base/12-HTTP的实体数据.html#数据类型使用的头字段" class="sidebar-link">数据类型使用的头字段</a></li><li class="sidebar-sub-header"><a href="/http-protocol/notes/base/12-HTTP的实体数据.html#语言类型使用的头字段" class="sidebar-link">语言类型使用的头字段</a></li><li class="sidebar-sub-header"><a href="/http-protocol/notes/base/12-HTTP的实体数据.html#内容协商的质量值" class="sidebar-link">内容协商的质量值</a></li><li class="sidebar-sub-header"><a href="/http-protocol/notes/base/12-HTTP的实体数据.html#内容协商的结果" class="sidebar-link">内容协商的结果</a></li><li class="sidebar-sub-header"><a href="/http-protocol/notes/base/12-HTTP的实体数据.html#小结" class="sidebar-link">小结</a></li></ul></li><li><a href="/http-protocol/notes/base/13-HTTP传输大文件.html" class="sidebar-link">HTTP传输大文件</a></li><li><a href="/http-protocol/notes/base/14-HTTP的连接管理.html" class="sidebar-link">HTTP的连接管理</a></li><li><a href="/http-protocol/notes/base/15-HTTP的重定向.html" class="sidebar-link">HTTP的重定向</a></li><li><a href="/http-protocol/notes/base/16-HTTP的Cookie机制.html" class="sidebar-link">HTTP的Cookie机制</a></li><li><a href="/http-protocol/notes/base/17-HTTP的缓存控制.html" class="sidebar-link">HTTP的缓存控制</a></li><li><a href="/http-protocol/notes/base/18-HTTP的代理服务.html" class="sidebar-link">HTTP的代理服务</a></li><li><a href="/http-protocol/notes/base/19-HTTP的缓存代理.html" class="sidebar-link">HTTP的缓存代理</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>高级篇</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/http-protocol/notes/advance/20-对称加密与非对称加密.html" class="sidebar-link">对称加密与非对称加密</a></li><li><a href="/http-protocol/notes/advance/21-数字签名与证书.html" class="sidebar-link">数字签名与证书</a></li><li><a href="/http-protocol/notes/advance/22-TLS1.2连接过程解析.html" class="sidebar-link">TLS1.2连接过程解析</a></li><li><a href="/http-protocol/notes/advance/23-TLS1.3特性解析.html" class="sidebar-link">TLS1.3特性解析</a></li><li><a href="/http-protocol/notes/advance/24-HTTPS的优化.html" class="sidebar-link">HTTPS的优化</a></li><li><a href="/http-protocol/notes/advance/25-迁移到HTTPS.html" class="sidebar-link">迁移到HTTPS</a></li><li><a href="/http-protocol/notes/advance/26-HTTP2特性概览.html" class="sidebar-link">HTTP2特性概览</a></li><li><a href="/http-protocol/notes/advance/27-HTTP3展望.html" class="sidebar-link">HTTP3展望</a></li><li><a href="/http-protocol/notes/advance/28-迁移到HTTP2.html" class="sidebar-link">迁移到HTTP2</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>扩展篇</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/http-protocol/notes/extend/29-CDN.html" class="sidebar-link">CDN</a></li><li><a href="/http-protocol/notes/extend/30-webSocket.html" class="sidebar-link">webSocket</a></li><li><a href="/http-protocol/notes/extend/31-HTTP性能优化上.html" class="sidebar-link">HTTP性能优化上</a></li><li><a href="/http-protocol/notes/extend/32-HTTP性能优化下.html" class="sidebar-link">HTTP性能优化下</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="数据类型与编码"><a href="#数据类型与编码" class="header-anchor">#</a> 数据类型与编码</h2> <ul><li>text：即文本格式的可读数据，我们最熟悉的应该就是 <code>text/html</code> 了，表示超文本文档，此外还有纯文本 <code>text/plain</code>、样式表 <code>text/css</code> 等。</li> <li><code>image</code>：即图像文件，有 <code>image/gif</code>、<code>image/jpeg</code>、<code>image/png</code> 等。</li> <li><code>audio/video</code>：音频和视频数据，例如 <code>audio/mpeg</code>、<code>video/mp4</code> 等。</li> <li><code>application</code>：数据格式不固定，可能是文本也可能是二进制，必须由上层应用程序来解释。常见的有 <code>application/json</code>，<code>application/javascript</code>、<code>application/pdf</code> 等，另外，如果实在是不知道数据是什么类型，像刚才说的“黑盒”，就会是 <code>application/octet-stream</code>，即不透明的二进制数据</li></ul> <blockquote><p>但仅有 <code>MIME type</code> 还不够，因为 <code>HTTP</code> 在传输时为了节约带宽，有时候还会压缩数据，为了不要让浏览器继续“猜”，还需要有一个“Encoding type”，告诉数据是用的什么编码格式，这样对方才能正确解压缩，还原出原始的数据。</p></blockquote> <p><strong>比起 <code>MIME type</code> 来说，<code>Encoding type</code> 就少了很多，常用的只有下面三种</strong></p> <ul><li><code>gzip</code>：<code>GNU zip</code> 压缩格式，也是互联网上最流行的压缩格式；</li> <li><code>deflate</code>：<code>zlib</code>（<code>deflate</code>）压缩格式，流行程度仅次于 <code>gzip</code>；</li> <li><code>br</code>：一种专门为 <code>HTTP</code> 优化的新压缩算法（<code>Brotli</code>）</li></ul> <h2 id="数据类型使用的头字段"><a href="#数据类型使用的头字段" class="header-anchor">#</a> 数据类型使用的头字段</h2> <p>有了 <code>MIME type</code> 和 <code>Encoding type</code>，无论是浏览器还是服务器就都可以轻松识别出 <code>body</code> 的类型，也就能够正确处理数据了。</p> <p><code>HTTP</code> 协议为此定义了两个 <code>Accept</code> 请求头字段和两个 <code>Content</code> 实体头字段，用于客户端和服务器进行“内容协商”。也就是说，客户端用 <code>Accept</code> 头告诉服务器希望接收什么样的数据，而服务器用 <code>Content</code> 头告诉客户端实际发送了什么样的数据</p> <p><img src="http://blog.poetries.top/img-repo/2019/12/15.png" alt=""></p> <blockquote><p><code>Accept</code>字段标记的是客户端可理解的 <code>MIME</code> type，可以用“,”做分隔符列出多个类型，让服务器有更多的选择余地，例如下面的这个头：</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>Accept: text/html,application/xml,image/webp,image/png
</code></pre></div><p>这就是告诉服务器：“我能够看懂 HTML、XML 的文本，还有 <code>webp</code> 和 <code>png</code> 的图片，请给我这四类格式的数据”。</p> <p>相应的，服务器会在响应报文里用头字段<code>Content-Type</code>告诉实体数据的真实类型：</p> <div class="language- extra-class"><pre class="language-text"><code>Content-Type: text/html
Content-Type: image/png
</code></pre></div><p>这样浏览器看到报文里的类型是“text/html”就知道是 HTML 文件，会调用排版引擎渲染出页面，看到“image/png”就知道是一个 PNG 文件，就会在页面上显示出图像。</p> <p>Accept-Encoding字段标记的是客户端支持的压缩格式，例如上面说的 gzip、deflate 等，同样也可以用“,”列出多个，服务器可以选择其中一种来压缩数据，实际使用的压缩格式放在响应头字段<code>Content-Encoding</code>里</p> <div class="language- extra-class"><pre class="language-text"><code>Accept-Encoding: gzip, deflate, br
Content-Encoding: gzip
</code></pre></div><p>不过这两个字段是可以省略的，如果请求报文里没有 <code>Accept-Encoding</code> 字段，就表示客户端不支持压缩数据；如果响应报文里没有 <code>Content-Encoding</code> 字段，就表示响应数据没有被压缩</p> <h2 id="语言类型使用的头字段"><a href="#语言类型使用的头字段" class="header-anchor">#</a> 语言类型使用的头字段</h2> <p>同样的，HTTP 协议也使用 <code>Accept</code> 请求头字段和 <code>Content</code> 实体头字段，用于客户端和服务器就语言与编码进行“内容协商”。</p> <p><code>Accept-Language</code>字段标记了客户端可理解的自然语言，也允许用“,”做分隔符列出多个类型，例如：</p> <div class="language- extra-class"><pre class="language-text"><code>Accept-Language: zh-CN, zh, en
</code></pre></div><p>这个请求头会告诉服务器：“最好给我 <code>zh-CN</code> 的汉语文字，如果没有就用其他的汉语方言，如果还没有就给英文”。</p> <p>相应的，服务器应该在响应报文里用头字段<code>Content-Language</code>告诉客户端实体数据使用的实际语言类型</p> <div class="language- extra-class"><pre class="language-text"><code>Content-Language: zh-CN
</code></pre></div><ul><li>字符集在 <code>HTTP</code> 里使用的请求头字段是<code>Accept-Charset</code>，但响应头里却没有对应的 <code>Content-Charset</code>，而是在<code>Content-Type</code>字段的数据类型后面用“<code>charset=xxx</code>”来表示，这点需要特别注意。</li> <li>例如，浏览器请求 <code>GBK</code> 或 <code>UTF-8</code> 的字符集，然后服务器返回的是 <code>UTF-8</code> 编码，就是下面这样</li></ul> <div class="language- extra-class"><pre class="language-text"><code>Accept-Charset: gbk, utf-8
Content-Type: text/html; charset=utf-8
</code></pre></div><p>不过现在的浏览器都支持多种字符集，通常不会发送 <code>Accept-Charset</code>，而服务器也不会发送 <code>Content-Language</code>，因为使用的语言完全可以由字符集推断出来，所以在请求头里一般只会有 <code>Accept-Language</code> 字段，响应头里只会有 <code>Content-Type</code>字段</p> <p><img src="http://blog.poetries.top/img-repo/2019/12/16.png" alt=""></p> <h2 id="内容协商的质量值"><a href="#内容协商的质量值" class="header-anchor">#</a> 内容协商的质量值</h2> <p>在 HTTP 协议里用 <code>Accept</code>、<code>Accept-Encoding</code>、<code>Accept-Language</code> 等请求头字段进行内容协商的时候，还可以用一种特殊的“q”参数表示权重来设定优先级，这里的“q”是“quality factor”的意思。</p> <p>权重的最大值是 1，最小值是 0.01，默认值是 1，如果值是 0 就表示拒绝。具体的形式是在数据类型或语言代码后面加一个“;”，然后是“q=value”。</p> <p>这里要提醒的是“;”的用法，在大多数编程语言里“;”的断句语气要强于“,”，而在 HTTP 的内容协商里却恰好反了过来，“;”的意义是小于“,”的。</p> <p>例如下面的 Accept 字段：</p> <div class="language- extra-class"><pre class="language-text"><code>Accept: text/html,application/xml;q=0.9,*/*;q=0.8
</code></pre></div><p>它表示浏览器最希望使用的是 HTML 文件，权重是 1，其次是 XML 文件，权重是 0.9，最后是任意数据类型，权重是0.8。服务器收到请求头后，就会计算权重，再根据自己的实际情况优先输出 HTML 或者 XML</p> <h2 id="内容协商的结果"><a href="#内容协商的结果" class="header-anchor">#</a> 内容协商的结果</h2> <p>内容协商的过程是不透明的，每个 Web 服务器使用的算法都不一样。但有的时候，服务器会在响应头里多加一个Vary字段，记录服务器在内容协商时参考的请求头字段，给出一点信息，例如：</p> <div class="language- extra-class"><pre class="language-text"><code>Vary: Accept-Encoding,User-Agent,Accept
</code></pre></div><p>这个 <code>Vary</code> 字段表示服务器依据了 <code>Accept-Encoding</code>、<code>User-Agent</code> 和 <code>Accept</code> 这三个头字段，然后决定了发回的响应报文。</p> <p><code>Vary</code> 字段可以认为是响应报文的一个特殊的“版本标记”。每当 <code>Accept</code> 等请求头变化时，<code>Vary</code> 也会随着响应报文一起变化。也就是说，同一个 <code>URI</code> 可能会有多个不同的“版本”，主要用在传输链路中间的代理服务器实现缓存服务，这个之后讲“HTTP 缓存”时还会再提到</p> <h2 id="小结"><a href="#小结" class="header-anchor">#</a> 小结</h2> <p><img src="http://blog.poetries.top/img-repo/2019/12/17.png" alt=""></p> <ul><li>数据类型表示实体数据的内容是什么，使用的是 <code>MIME type</code>，相关的头字段是 <code>Accept</code>和 <code>Content-Type</code>；</li> <li>数据编码表示实体数据的压缩方式，相关的头字段是 <code>Accept-Encoding</code> 和 <code>Content-Encoding</code>；</li> <li>语言类型表示实体数据的自然语言，相关的头字段是 <code>Accept-Language</code> 和 <code>Content-Language</code>；</li> <li>字符集表示实体数据的编码方式，相关的头字段是 <code>Accept-Charset</code>和 Content-Type；</li> <li>客户端需要在请求头里使用 <code>Accept</code> 等头字段与服务器进行“内容协商”，要求服务器返回最合适的数据；
<code>Accept</code> 等头字段可以用“,”顺序列出多个可能的选项，还可以用“<code>;q=</code>”参数来精确指定权重</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2019/12/7 上午9:27:16</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/http-protocol/notes/base/11-HTTP优缺点.html" class="prev">HTTP优缺点</a></span> <span class="next"><a href="/http-protocol/notes/base/13-HTTP传输大文件.html">HTTP传输大文件</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/http-protocol/assets/js/app.0cce05a9.js" defer></script><script src="/http-protocol/assets/js/4.7a93d0ed.js" defer></script><script src="/http-protocol/assets/js/35.220afe2a.js" defer></script><script src="/http-protocol/assets/js/7.1fd81328.js" defer></script>
  </body>
</html>
